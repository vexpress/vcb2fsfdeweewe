{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, HostListener } from '@angular/core';\nimport { ApiUrl } from 'src/app/core/apiUrl';\nimport swal from 'sweetalert2';\nimport { debounceTime, distinctUntilChanged } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\nlet ListDealerComponent = class ListDealerComponent {\n  constructor(router, http, message, toastr, user) {\n    this.router = router;\n    this.http = http;\n    this.message = message;\n    this.toastr = toastr;\n    this.user = user;\n    this.status = false;\n    this.isLoading = false;\n    this.displayedColumns = ['name', 'email', 'contactNumber', 'staff'];\n    this.dataSource = [];\n    this.searchDealer = '';\n    this.isFullListDisplayed = false;\n    this.pageNumber = 1;\n    this.pageSize = 20;\n    this.searchterm = new Subject();\n    this.loadCompleted = false;\n    this.tableLoad = true;\n    this.fromDelete = false;\n    this.searchterm.pipe(\n    // Time in milliseconds between key events\n    debounceTime(500)\n    // If previous query is diffent from current\n    , distinctUntilChanged()\n    // subscription for response\n    ).subscribe(term => {\n      this.dataSource = [];\n      this.pageNumber = 1;\n      this.pageSize = 20;\n      this.isFullListDisplayed = false;\n      this.getAllCenters();\n    });\n  }\n  onKeydownHandler(event) {\n    swal.close();\n  }\n  ngOnInit() {\n    var _a, _b;\n    this.getAllCenters();\n    this.rolePermissions = this.user.getRoleGroup();\n    if (((_a = this.rolePermissions) === null || _a === void 0 ? void 0 : _a.isEdit) || ((_b = this.rolePermissions) === null || _b === void 0 ? void 0 : _b.isDelete)) {\n      this.displayedColumns = ['name', 'email', 'contactNumber', 'staff', 'actions'];\n    }\n  }\n  /*** Get Centers Listing ***/\n  getAllCenters() {\n    this.isLoading = true;\n    const params = {\n      PageNumber: this.pageNumber,\n      PageSize: this.pageSize,\n      Search: this.searchDealer\n    };\n    this.http.getData(ApiUrl.admin.center, params, true).subscribe(response => {\n      this.isLoading = false;\n      if (!!response) {\n        const result = response.result ? response.result : [];\n        if (result.length < this.pageSize) this.loadCompleted = true;\n        result.forEach(ele => {\n          ele.actions = '';\n        });\n        if (this.fromDelete) {\n          this.dataSource = [...result];\n          this.fromDelete = false;\n          this.dataTableReload();\n        } else {\n          this.dataSource = [...this.dataSource, ...result];\n        }\n        if (this.dataSource.length === 0) this.toastr.error(\"No results matching the search criteria!\");\n      }\n    });\n  }\n  /*** On Search ***/\n  clickEvent() {\n    this.loadCompleted = false;\n    this.status = !this.status;\n    this.searchDealer = this.status ? this.searchDealer : '';\n    if (!this.searchDealer) {\n      this.applyFilter();\n    }\n  }\n  dataTableReload() {\n    this.tableLoad = false;\n    setTimeout(() => {\n      this.tableLoad = true;\n    }, 100);\n  }\n  /*** Get Staff Details ***/\n  centreDetails(id) {\n    this.router.navigate(['admin/all-staff', id]);\n  }\n  /*** Edit Dealer ***/\n  editCentre(id) {\n    this.router.navigate(['admin/edit-dealer', id]);\n  }\n  /*** Remove Dealer ***/\n  removeCenter(id) {\n    this.http.deleteRecord(ApiUrl.admin.center + '/' + id + '/false').subscribe(response => {\n      if (!!response) {\n        this.message.toast('success', response.message);\n        this.getAllCenters();\n        this.fromDelete = true;\n      }\n    });\n  }\n  /*** Confirm Delete ***/\n  confirmDelete(id) {\n    this.message.confirm('inactivate this centre').then(data => {\n      if (data.value) {\n        this.removeCenter(id);\n      }\n    });\n  }\n  confirmActivate(id, isActive) {\n    this.message.confirm(isActive ? 'activate this centre' : 'inactivate this centre').then(data => {\n      if (data.value) {\n        this.activateCentre(id, isActive);\n      }\n    });\n  }\n  activateCentre(id, isActive) {\n    this.http.deleteRecord(ApiUrl.admin.center + '/' + id + '/' + isActive).subscribe(response => {\n      if (!!response) {\n        this.message.toast('success', response.message);\n        this.fromDelete = true;\n        this.dataSource = [...[]];\n        this.getAllCenters();\n      }\n    });\n  }\n  /*** On Search ***/\n  applyFilter() {\n    this.searchterm.next(this.searchDealer);\n  }\n  /*** On Scroll load data ***/\n  onScroll() {\n    if (this.pageNumber * this.pageSize <= this.dataSource.length && !this.loadCompleted) {\n      this.pageNumber++;\n      this.getAllCenters();\n    } else {\n      this.isFullListDisplayed = true;\n    }\n  }\n};\n__decorate([HostListener('document:keydown.escape', ['$event'])], ListDealerComponent.prototype, \"onKeydownHandler\", null);\nListDealerComponent = __decorate([Component({\n  selector: 'app-list-dealer',\n  templateUrl: './list-dealer.component.html',\n  styleUrls: ['./list-dealer.component.scss']\n})], ListDealerComponent);\nexport { ListDealerComponent };","map":null,"metadata":{},"sourceType":"module"}